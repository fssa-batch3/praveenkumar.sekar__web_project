<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Catamaran:wght@100;200;300;400;500;600;700;800;900&family=Neuton:ital,wght@0,200;0,300;0,400;0,700;0,800;1,400&family=Telex&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../../assets/css/cart.css">
    <link rel="stylesheet" href="../../assets/css/header.css">
    <link rel="stylesheet" href="../../assets/css/normalize.css">
    <link rel="stylesheet" href="../../assets/css/footer.css">

    <title>Bakery</title>
</head>

<body>
    <!-- <header id="header">
        <div class="container">
            <img src="../../assets/Images/v1033-a-15-a-removebg-preview - Copy.svg" width="100px" alt="logo">
            <nav>
                <ul>
                    <li><a href="../../index.html">Home</a></li>
                    <li><a href="../products/product_list.html">Products</a></li>
                    <li><a href="../Log in and Sign up/Log in.html">Log In</a></li>
                    <li><a href="../Cart/cart.html"><img src="../../assets/Images/icon-cart.svg" alt="cart"></a></li>
                    <li><a href="../Profile/profile.html"><img src="../../assets/Images/profile.svg" width="26px"
                                alt="profile"></a></li>
                </ul>
            </nav>
    </header> -->
    <div class="cart">
        <img src="../../assets/Images/v1033-a-15-a-removebg-preview - Copy.svg" width="100px" alt="logo">
        <table class="table">
            <caption>
                <h1>YOUR CART(3)</h1>
            </caption>
            <tr>
                <th>Products</th>
                <th>Quantity</th>
                <th>Subtotal</th>
            </tr>
            <!-- <tr>
                        <td>
                            <div class="cart-info">
                                <img src="../../assets/Images/Breads/burger-bun-removebg-preview.png" width="200px" height="200px" alt="burger bun">
                                <div class="details">
                                    <p>Burger Bun</p>
                                    <small>Price:₹30.00</small>
                                    <a href="#">Remove</a>
                                </div>
                            </div>
                        </td>
                        <td>
                            <input type="number" value="1">
                        </td>
                        <td class="price">
                            <p>₹30.00</p>
                        </td>
                    </tr> -->
            <!-- <tr>
                        <td>
                            <div class="cart-info">
                                <img src="../../assets/Images/breads/sweet-bread-removebg-preview.png" width="200px" height="200px" alt="sweet bread">
                                <div class="details">
                                    <p>Sweet Bread</p>
                                    <small>Price:₹40.00</small>
                                    <a href="#">Remove</a>
                                </div>
                            </div>
                        </td>
                        <td>
                            <input type="number" value="1">
                        </td>
                        <td class="price">
                            <p>₹40.00</p>
                        </td>
                    </tr> -->
            <!-- <tr>
                        <td>
                            <div class="cart-info">
                                <img src="../../assets/Images/breads/cereal-bread-removebg-preview.png" width="200px" height="200px" alt="cereal bread">
                                <div class="details">
                                    <p>Cereal Bread</p>
                                    <small>Price:₹50.00</small>
                                    <a href="#">Remove</a>
                                </div>
                            </div>
                        </td>
                        <td>
                            <input type="number" value="1">
                        </td>
                        <td class="price">
                            <p>₹50.00</p>
                        </td>
                    </tr> -->
        </table>


        <div class="total-price">
            <table>
                <caption></caption>
                <tr>
                    <th></th>
                </tr>
                <tr>
                    <td>
                        <p>Subtotal</p>
                    </td>
                    <td>
                        <p id="sub"></p>
                    </td>
                </tr>
                <tr>
                    <td>
                        <p>Tax</p>
                    </td>
                    <td>
                        <p id="tax"></p>
                    </td>
                </tr>
                <tr>
                    <td>
                        <p>Total</p>
                    </td>
                    <td>
                        <p id="total"></p>
                    </td>
                </tr>
            </table>
        </div>
        <div class="checkout">
            <button>Check Out</button>
        </div>
    </div>
    <footer>
        <div class="foot">
            <h1>HOME BAKERY</h1>
            <div class="list">
                <ul>
                    <li>
                        <h2>ABOUT</h2>
                    </li>
                    <li><a href="../../index.html">Homepage</a></li>
                    <li><a href="../../../../index.html#about">About Us</a></li>
                    <li><a href="../../../../index.html#history">Our History</a></li>
                    <li><a href="../products/product_list.html">Products</a></li>
                </ul>
                <ul>
                    <li>
                        <h2>PRODUCTS</h2>
                    </li>
                    <li><a href="../products/product_list.html">Breads</a></li>
                    <li><a href="../products/product_list.html">Cakes</a></li>
                    <li><a href="../products/product_list.html">Breakfast Pastries</a></li>
                </ul>
                <ul>
                    <li>
                        <h2>FOLLOW US</h2>
                    </li>
                    <a href="https://www.instagram.com/">
                        <li><img src="../../assets/Images/instagram.svg" width="40px" alt="Instagram">Instagram</li>
                    </a>
                    <a href="https://twitter.com/">
                        <li><img src="../../assets/Images/twitter.svg" width="40px" alt="Twitter">Twitter</li>
                    </a>
                    <a href="https://github.com/">
                        <li><img src="../../assets/Images/github.svg" width="40px" alt="GitHub">GitHub</li>
                    </a>
                </ul>
            </div>
        </div>

    </footer>

<script src="../../assets/header.js"></script>

    <script>

        // let prod_details = JSON.parse(localStorage.getItem("prod_detail"));

        let cart_id = JSON.parse(localStorage.getItem("cart_id"));

        // let cart_detail = prod_details.filter(product =>
        //     cart_id.some(kart_id => kart_id.product_id === product.product_id))

        // console.log(cart_detail);

        let cart = JSON.parse(localStorage.getItem("add_to_cart"));
        console.log(cart);


        let subtotal = 0;
        let tax = 0;

        for (i = 0; i < cart.length; i++) {

            table_r = document.createElement("tr");
            console.log(table_r)

            td1 = document.createElement("td");
            table_r.append(td1);

            cart_info = document.createElement("div")
            cart_info.setAttribute("class", "cart-info");
            td1.append(cart_info);

            cart_img = document.createElement("img");
            cart_img.setAttribute("class", "cart-img");
            cart_img.setAttribute("src", cart[i]["image"])
            cart_img.setAttribute("width", "200px");
            cart_img.setAttribute("height", "200px");
            cart_info.append(cart_img);

            detail = document.createElement("div");
            detail.setAttribute("class", "details");
            cart_info.append(detail);

            prod_name = document.createElement("p")
            prod_name.innerText = cart[i]["product_name"];
            detail.append(prod_name);

            price = document.createElement("small");
            price.innerText = "Price: " + cart[i]["test_price"];
            detail.append(price);

            remove = document.createElement("button")
            remove.setAttribute("class", "remove");
            remove.innerText = (" " + "Remove");
            detail.append(remove);

            td2 = document.createElement("td");
            td2.setAttribute("class", "quantity");
            td2.setAttribute("data-id", cart[i]["product_id"]); 
            table_r.append(td2);

            let find = cart.find(e => e.product_id ==  cart[i]["product_id"]);

            inp = document.createElement("input");
            inp.setAttribute("class", "inp");
            inp.setAttribute("type", "number");
            inp.setAttribute("value", cart[i]["quantity"]);
            td2.append(inp);

            td3 = document.createElement("td");
            td3.setAttribute("class", "price");
            table_r.append(td3);

            price2 = document.createElement("p");
            price2.innerText = "Price: " + cart[i]["test_price"]*cart[i]["quantity"];
            td3.append(price2);

            document.querySelector("table.table").append(table_r);

            subtotal+= cart[i]["test_price"]*cart[i]["quantity"];
        }

        document.querySelector("#sub").innerText = "₹ " + subtotal;
        tax = subtotal/20;;
        document.querySelector("#tax").innerText = "₹ " + tax;
        let total = subtotal + tax;
        document.querySelector("#total").innerText = "₹ " + total;

        let remove_item = document.querySelectorAll("button.remove");

        remove_item.forEach(function (getID) {
            getID.addEventListener("click", function () {
                if (confirm("Are you sure?")) {
                    let cart = JSON.parse(localStorage.getItem("cart"));

                    function find_data(e) {
                        return e.cart == cart;
                    }

                    product_data = cart.find(find_data);

                    const indexOfUser = cart.indexOf(product_data);

                    cart.splice(indexOfUser, 1);

                    localStorage.setItem('cart', JSON.stringify(cart));

                    window.location.reload();
                }
            }
            )
        }
        );

        let quantity = document.querySelectorAll(".inp");

        quantity.forEach(function (getQuantity) {
            getQuantity.addEventListener("click", function () {
                let parent = this.closest(".quantity");
                let quan = parent.querySelector(".inp").value
                let uuid = parent.getAttribute("data-id");

                let cart = JSON.parse(localStorage.getItem("add_to_cart"));

                let update_cart = cart.filter(e => e.product_id == uuid)

                if(update_cart){
                    update_cart[0].quantity = parseInt(quan)
                    localStorage.setItem("add_to_cart", JSON.stringify(cart));
                }
                location.reload();
            }
        )})

        
    </script>
</body>

</html>